# 領収書・請求書AI仕訳 Webアプリ

領収書や請求書の画像からAIで仕訳を推測し、会計ソフト用のCSVファイルを自動生成するWebアプリケーションです。

## 機能

- 📷 画像ファイル（PNG、JPG、JPEG）のアップロード
- 📄 PDFファイルのアップロード（OCR対応）
- 🔍 OCRによるテキスト抽出（日本語対応）
  - Google Cloud Vision API（推奨）
  - Tesseract OCR（フォールバック）
- 🤖 AIによる仕訳情報の自動推測
  - 会社名
  - 取引日
  - 金額
  - 消費税区分（内税/外税/自動判定）
  - 摘要
  - 勘定科目
- 🎯 立場選択（受領/発行）
- 📊 会計ソフト用CSVファイルの自動生成
  - 汎用CSV形式
  - マネーフォワード形式
  - テキスト形式
- 💾 ファイル名：`会社名_日付_output.csv`形式

## セットアップ

### 前提条件

- Python 3.8以上
- macOS（Homebrew使用）

### 1. 依存関係のインストール

```bash
# Tesseract（OCRエンジン）のインストール
brew install tesseract
brew install tesseract-lang

# Pythonパッケージのインストール
pip install -r requirements.txt
```

### 2. 環境変数の設定

```bash
# OpenAI APIキー
export OPENAI_API_KEY="your-openai-api-key"

# Google Cloud Vision API（オプション）
export GOOGLE_APPLICATION_CREDENTIALS="path/to/service-account.json"
```

### 3. アプリの起動

```bash
streamlit run app.py
```

ブラウザで `http://localhost:8501` にアクセスしてアプリを使用できます。

## 使い方

1. **ファイルアップロード**
   - 「画像またはPDFをアップロード」ボタンをクリック
   - 領収書・請求書の画像ファイルを選択（複数可）

2. **設定選択**
   - 立場：受領（費用）または発行（売上）
   - 消費税区分：自動判定/内税10%/外税10%/内税8%/外税8%

3. **仕訳CSV作成**
   - 「仕訳CSVを作成」ボタンをクリック
   - OCR処理が実行され、抽出されたテキストと推測結果が表示されます

4. **CSVダウンロード**
   - 生成されたCSVファイルをダウンロード
   - ファイル名は `会社名_日付_output.csv` 形式

## 対応する勘定科目

### 費用系（受領側）
- 研修費（講義、研修関連）
- 教育研修費（セミナー、教育関連）
- 旅費交通費（交通、タクシー関連）
- 通信費（通信、電話、郵便関連）
- 消耗品費（事務用品、文具関連）
- 会議費（会議、ミーティング関連）
- 交際費（接待、贈答関連）
- 広告宣伝費（広告、PR関連）
- 外注費（外部委託関連）
- 支払手数料（手数料関連）
- 仮払金（一時的な支払い）
- 修繕費（修理、メンテナンス関連）
- 仕入高（商品仕入れ関連）
- 減価償却費（資産の減価償却）

### 収入系（発行側）
- 売上高（商品・サービス販売）
- 雑収入（その他の収入）
- 受取手形（手形による回収）
- 売掛金（掛け売りによる回収）

## AI機能

- **GPT-4.1-nano**を使用した高精度な勘定科目推測
- 日本の会計実務に特化したプロンプト設計
- 郵便・配送サービスは自動的に「通信費」に分類
- 期間情報（x月分等）の摘要への自動反映

## 注意事項

- 画像の品質が良いほど、OCRの精度が向上します
- 手書き文字の認識精度は印刷文字より低くなります
- HEICファイルは現在対応していません（JPEGに変換してからアップロードしてください）
- 10%・8%混在レシートの場合は、手動で2仕訳に分けてください

## トラブルシューティング

### OCRが動作しない場合

```bash
# Tesseractのインストール確認
tesseract --version

# 日本語言語パックの確認
tesseract --list-langs
```

### パッケージのインストールエラー

```bash
# パッケージの再インストール
pip install --upgrade pip
pip install -r requirements.txt --force-reinstall
```

### APIキーの設定確認

```bash
# 環境変数の確認
echo $OPENAI_API_KEY
echo $GOOGLE_APPLICATION_CREDENTIALS
```

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。 